# v0.7.0 记忆与课程表管理功能

## 📅 课程表管理

### 功能说明
用户可以通过可视化界面查看和编辑课程表，无需依赖图片识别。

### 使用方法
1. 点击顶部 **📅 课程表** 标签
2. 点击 **🔄 刷新课程表** 按钮加载当前课程表
3. 在表格中直接编辑课程名称（支持输入框编辑）
4. 点击 **💾 保存修改** 按钮保存到数据库

### API接口

#### 获取课程表
```bash
GET /api/schedule?user_id=default_user
```

**响应示例：**
```json
{
  "success": true,
  "schedule": {
    "periods": ["第1节", "第2节", "第3节", "第4节", "第5节"],
    "weekdays": ["周一", "周二", "周三", "周四", "周五"],
    "courses": {
      "0_周一": "晨读",
      "1_周一": "数学",
      "3_周一": "科学(5)"
    }
  }
}
```

#### 保存课程表
```bash
POST /api/schedule
Content-Type: application/json

{
  "user_id": "default_user",
  "schedule": {
    "periods": [...],
    "weekdays": [...],
    "courses": {...}
  }
}
```

### 数据存储
- 课程表保存在 `memories` 表，`tag='schedule'`
- 自动解析图片识别结果（tag='image'）
- 优先使用手动编辑的课程表

---

## 🧠 记忆管理 CRUD

### 功能说明
用户可以在记忆管理页面直接编辑和删除记忆，无需通过对话操作。

### 使用方法
1. 点击顶部 **🧠 记忆** 标签
2. 使用搜索框查找记忆（支持关键词、语义搜索）
3. 每条记忆显示：
   - 内容、标签、时间戳
   - **✏️ 编辑** 按钮 - 修改内容和标签
   - **🗑️ 删除** 按钮 - 删除记忆（需确认）

### API接口

#### 更新记忆
```bash
PUT /api/memory/{memory_id}
Content-Type: application/json

{
  "content": "新的记忆内容",
  "tag": "facts"
}
```

**响应示例：**
```json
{
  "success": true,
  "message": "记忆已更新"
}
```

#### 删除记忆
```bash
DELETE /api/memory/{memory_id}
```

**响应示例：**
```json
{
  "success": true,
  "message": "记忆已删除"
}
```

### 前端实现
- `editMemory(memoryId, currentTag)` - 弹出编辑对话框
- `deleteMemory(memoryId)` - 确认后删除并从DOM移除
- 自动刷新列表或动画移除元素

---

## 🎯 使用场景

### 课程表管理
1. **初次录入**：上传课程表图片 → 识别 → 查看课程表页面 → 修正错误
2. **日常更新**：直接在课程表页面修改 → 保存
3. **查询课程**：小乐会从schedule记忆中读取最新课程表

### 记忆管理
1. **纠正错误**：发现记忆错误 → 编辑记忆 → 保存
2. **删除重复**：搜索关键词 → 删除重复记忆
3. **维护质量**：定期检查记忆列表 → 删除无用记忆

---

## 🔧 技术实现

### 前端 (static/index.html)
- **课程表管理**：
  - `loadSchedule()` - 加载课程表数据
  - `parseScheduleFromMemory()` - 从记忆解析
  - `renderSchedule()` - 渲染表格
  - `updateCourse()` - 更新单个课程
  - `saveSchedule()` - 保存到后端

- **记忆管理**：
  - `editMemory()` - 编辑对话框
  - `deleteMemory()` - 删除确认
  - 搜索结果中自动添加操作按钮

### 后端 (main.py)
- **课程表API**：
  - `GET /api/schedule` - 查询schedule/image/facts记忆
  - `POST /api/schedule` - 保存为schedule记忆
  - 自动解析周X：课程1-课程2格式

- **记忆API**：
  - `PUT /api/memory/{id}` - 更新content和tag
  - `DELETE /api/memory/{id}` - 删除记忆
  - 使用MemoryManager操作数据库

---

## ✅ 测试清单

### 课程表管理
- [ ] 加载现有课程表（从image记忆解析）
- [ ] 编辑课程名称
- [ ] 保存修改到数据库
- [ ] 刷新后数据保持
- [ ] 小乐能正确回答课程查询

### 记忆管理
- [ ] 编辑记忆内容
- [ ] 编辑记忆标签
- [ ] 删除记忆
- [ ] 删除后记忆不再出现在搜索结果
- [ ] 编辑后小乐使用新内容回答

---

## 🚀 下一步计划

1. **提醒历史查看** - 显示已触发的提醒记录
2. **批量操作** - 选择多条记忆批量删除
3. **高级搜索** - 按标签、时间范围筛选
4. **导入导出** - 备份和恢复记忆数据
5. **课程表可视化** - 添加颜色标记、时间轴视图

---

## 📝 版本信息

- **版本号**: v0.7.0
- **发布日期**: 2025-01-12
- **主要改进**:
  - ✅ 课程表可视化管理
  - ✅ 记忆CRUD操作
  - ✅ 前后端完整实现

